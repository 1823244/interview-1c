// JOINS

//---- ГОРОДА
Выбрать
	1 как ИД
	,"Москва" КАК Имя
Поместить Города
Объединить все
Выбрать
	2 как ИД
	,"Лондон" КАК Имя
Объединить все
Выбрать
	3 как ИД
	,"Сингапур" КАК Имя
Объединить все
Выбрать
	4 как ИД
	,"Сидней" КАК Имя
;

//---- ОФИСЫ
Выбрать
	1 как ИД
	,1 КАК Город
	,"ОфисМосква1" КАК Имя
Поместить Офисы
Объединить все
Выбрать
	2 как ИД
	,1 КАК Город
	,"ОфисМосква2" КАК Имя
Объединить все
Выбрать
	3 как ИД
	,2 КАК Город
	,"ОфисЛондон" КАК Имя
Объединить все
Выбрать
	4 как ИД
	,5 КАК Город
	,"ОфисБангкок" КАК Имя
;

//--------------  ВЫБОРКА
Выбрать
	"Все города", *
ИЗ
	Города
;
Выбрать
	"Все офисы", *
ИЗ
	Офисы

;
//
Выбрать
	"CROSS-JOIN. Строк = 16. Декартово произведение"
    , *
ИЗ
	Города , Офисы
;
//
Выбрать
	"LEFT-JOIN по Истине, фактически аналог CROSS-JOIN. Строк = 16. Декартово произведение"
    , *
ИЗ
	Города 
	LEFT JOIN Офисы
	ON Истина
;
// 
Выбрать
	"RIGHT-JOIN по Истине, фактически аналог CROSS-JOIN. Строк = 16. Декартово произведение"
    , *
ИЗ
	Города 
	RIGHT JOIN Офисы
	ON Истина
;
// 
Выбрать
	"FULL-JOIN по Истине, фактически аналог CROSS-JOIN. Строк = 16. Декартово произведение"
    , *
ИЗ
	Города 
	FULL JOIN Офисы
	ON Истина
;

// 
Выбрать
	"LEFT-JOIN по ЛОЖЬ, Строк = 4. Все из городов, ничего из офисов"
    , *
ИЗ
	Города 
	LEFT JOIN Офисы
	ON ЛОЖЬ
;

// 
Выбрать
	"RIGHT-JOIN по ЛОЖЬ, Строк = 4. Все из офисов, ничего из городов"
    , *
ИЗ
	Города 
	LEFT JOIN Офисы
	ON ЛОЖЬ
;

// 
Выбрать
	"FULL-JOIN по ЛОЖЬ, Строк = 8. Все из офисов, все из городов, но не пересекаются"
    , *
ИЗ
	Города 
	FULL JOIN Офисы
	ON ЛОЖЬ
;

// 
Выбрать
	"LEFT-JOIN. Строк = 5. Всё из Городов (Москва 2 раза), только совпадения из Офисов"
    , *
ИЗ
	Города 
	LEFT JOIN Офисы
	ON Офисы.Город = Города.ИД
;

// 
Выбрать
	"RIGHT-JOIN. Строк = 4. Всё из Офисов, только совпадения из Городов"
    , *
ИЗ
	Города 
	RIGHT JOIN Офисы
	ON Офисы.Город = Города.ИД
;
// FULL-JOIN. Строк = 6. Всё из Офисов, всё Городов
// для Москвы - 2 строки, т.к. 2 офиса
Выбрать
	"FULL-JOIN. Строк = 6. Всё из Офисов, всё Городов, Москва 2 раза"
    , *
ИЗ
	Города 
	FULL JOIN Офисы
	ON Офисы.Город = Города.ИД
;

// AGGREGATES

// SALARIES


Выбрать
	1000 как Зарплата
	,"Кассир" КАК Должность
	,"Магазин" КАК Подразделение
Поместить Компания
Объединить все
Выбрать
	2000 как Зарплата
	,"Кладовщик" КАК Должность
	,"Магазин" КАК Подразделение
Объединить все
Выбрать
	2000 как Зарплата
	,"Водитель погрузчика" КАК Должность
	,"Магазин" КАК Подразделение
Объединить все
Выбрать
	4000 как Зарплата
	,"Директор" КАК Должность
	,"Магазин" КАК Подразделение

Объединить все
Выбрать
	5000 как Зарплата
	,"Менеджер по продажам" КАК Должность
	,"Оптовый отдел" КАК Подразделение
Объединить все
Выбрать
	6000 как Зарплата
	,"Руководитель отдела" КАК Должность
	,"Оптовый отдел" КАК Подразделение
Объединить все
Выбрать
	6000 как Зарплата
	,"Программист" КАК Должность
	,"Оптовый отдел" КАК Подразделение
;
// выбрать должности с максимальной зарплатой в разрезе подразделений
// вариант через INNER JOIN. Похожим образом работает срез последних
Выбрать
	Компания.Должность,
	Компания.Подразделение,
	Компания.Зарплата
из
	Компания
	inner join
	(
		выбрать
			МАКСИМУМ(Зарплата) КАК МаксЗарплата,
			Подразделение
		
		ИЗ
			Компания
		Сгруппировать по
			Подразделение
	) КАК Подзапрос
	ПО Подзапрос.Подразделение = Компания.Подразделение
	И Компания.Зарплата = Подзапрос.МаксЗарплата
;
// вариант через вхождение в подзапрос
Выбрать
	Компания.Должность,
	Компания.Подразделение,
	Компания.Зарплата
из
	Компания
где
	(Компания.Зарплата, Компания.Подразделение) В
	(
		выбрать
			МАКСИМУМ(Зарплата) КАК МаксЗарплата,
			Подразделение
		
		ИЗ
			Компания
		Сгруппировать по
			Подразделение
	) 



	